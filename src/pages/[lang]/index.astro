---
import Layout from '../../layouts/Layout.astro';
import ProjectCard from '../../components/ProjectCard.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../i18n/utils';

export async function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'zh' } },
  ];
}

const { lang } = Astro.params;
const t = useTranslations(lang as 'en' | 'zh');

const allProjects = await getCollection('projects');
const personalProjects = allProjects.filter(p => p.data.category === 'Personal');
const commercialProjects = allProjects.filter(p => p.data.category === 'Commercial');

// Calculate total hours for personal projects
const totalHours = personalProjects.reduce((acc, curr) => acc + (curr.data.metrics?.hours || 0), 0);
---

<Layout title={t('nav.home')}>
  {/* Hero Section */}
  <section class="py-20 text-center">
    <h1 class="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight">
      <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600">
        Game Designer
      </span>
    </h1>
    <p class="text-xl text-gray-400 max-w-2xl mx-auto mb-8">
      Crafting systems, gameplay, and worlds.
    </p>
  </section>

  {/* Personal Projects */}
  <section class="mb-20">
    <div class="flex items-center justify-between mb-8 border-b border-gray-800 pb-4">
      <h2 class="text-3xl font-bold flex items-center gap-3">
        <span class="w-2 h-8 bg-blue-500 rounded-full"></span>
        {t('project.personal')}
      </h2>
      <div class="text-right">
        <div class="text-2xl font-mono font-bold text-blue-400">{totalHours}</div>
        <div class="text-xs text-gray-500 uppercase tracking-wider">{t('metric.hours')}</div>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {personalProjects.map(project => (
        <ProjectCard project={project} lang={lang as 'en' | 'zh'} />
      ))}
    </div>
  </section>

  {/* Commercial Projects */}
  <section class="mb-20">
    <div class="flex items-center justify-between mb-8 border-b border-gray-800 pb-4">
      <h2 class="text-3xl font-bold flex items-center gap-3">
        <span class="w-2 h-8 bg-green-500 rounded-full"></span>
        {t('project.commercial')}
      </h2>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {commercialProjects.map(project => (
        <ProjectCard project={project} lang={lang as 'en' | 'zh'} />
      ))}
    </div>
  </section>
</Layout>
